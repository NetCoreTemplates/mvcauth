@if (Context.Features.Get<Microsoft.AspNetCore.Http.Features.ITrackingConsentFeature>()?.CanTrack == false) 
{
    <blockquote class="blockquote text-center">
        <p class="mb-0">Authentication requires User to accept cookies.</p>
    </blockquote>
}

<div class="row" style="margin-top: 2em">
@if (!Model.IsAuthenticated)
{
    <div class="col-lg-6">
        <h3>Sign In using 3rd Party Provider</h3>
        <div style="float: left; width: 250px; padding: 0 0 0 0;">
            <a class="btn btn-block btn-social btn-twitter" href="/auth/twitter">
                <i class="fab fa-twitter"></i>Sign in with Twitter
            </a>
            <a class="btn btn-block btn-social btn-facebook" href="/auth/facebook">
                <i class="fab fa-facebook-f"></i>Sign in with Facebook
            </a>
            <a class="btn btn-block btn-social btn-google" href="/auth/google">
                <i class="fab fa-google"></i>Sign in with Google
            </a>
            <a class="btn btn-block btn-social btn-microsoft" href="/auth/microsoftgraph">
                <i class="fab fa-microsoft"></i>Sign in with Microsoft
            </a>
        </div>
    </div>
    <div class="col-lg-6">

        <h3>Sign In using credentials</h3>
        
        <form action="@(ViewData["LoginPath"] ?? "/Home/Login")" method="post">
            <div class="form-row">
                @Html.ValidationSummary()
                <input type="hidden" name="redirect" value="@(Html.GetQueryString("ReturnUrl") ?? ViewData["ReturnUrl"])" />
            </div>

            <div class="form-row">
                <div class="form-group">
                    <input class="form-control input-lg" id="userName" name="userName" type="text" placeholder="UserName" value="@Html.GetFormData("userName")">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <input class="form-control input-lg" id="password" name="password" type="password" placeholder="Password" value="">
                </div>
                <div class="form-group col-md-4">
                    <button type="submit" class="btn btn-primary">Login</button>
                </div>
                <div class="form-group col-md-4">
                    <a class="lnk" asp-area="" asp-controller="Account" asp-action="Register" asp-route-ReturnUrl="@ViewData["ReturnUrl"]">Register New User</a>
                </div>
            </div>
            <div>
                <b>Quick Login:</b>
                <span data-click="switchUser:user@@gmail.com">user@@gmail.com</span>
                <span data-click="switchUser:manager@@gmail.com">manager@@gmail.com</span>
                <span data-click="switchUser:new@@user.com">new@@user.com</span>
            </div>
        </form>        
    </div>
}
else
{
    <div class="col-lg-6">
        <table class="table table-bordered">
            <caption style="caption-side:top;">Authenticated User Session</caption>
            <tbody>
                <tr>
                    <th>Id</th>
                    <td>@Model.Id</td>
                </tr>
                <tr>
                    <th>UserAuthId</th>
                    <td>@Model.UserAuthId</td>
                </tr>
                <tr>
                    <th>Email</th>
                    <td>@Model.Email</td>
                </tr>
                <tr>
                    <th>UserName</th>
                    <td>@Model.UserName</td>
                </tr>
                <tr>
                    <th>UserAuthName</th>
                    <td>@Model.UserAuthName</td>
                </tr>
                <tr>
                    <th>DisplayName</th>
                    <td>@Model.DisplayName</td>
                </tr>
                <tr>
                    <th>AuthProvider</th>
                    <td>@Model.AuthProvider</td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="2"><a href="/auth/logout?continue=/">Sign Out</a></td>
                </tr>
            </tfoot>
        </table>
    </div>
}
</div>

<div class="row" style="margin-top:40px">
    <div class="col-lg-6">
        <h3>Public APIs and Pages</h3>
        
        <ul>
            <li><a href="/Home/Privacy">/Home/Privacy</a> - Privacy MVC Page</li>
            <li><a href="/Account/Login">/Account/Login</a> - Sign In MVC Page</li>
            <li><a href="/Account/Register">/Account/Register</a> - Register User MVC Page</li>
        </ul>
        
        <form action="/hello">
            <h4>/hello ServiceStack API</h4>
            <label>Name: </label>
            <input type="text" class="txtName" name="Name" style="margin: 10px" />
            <span class="apiurl"></span>
            <div class="result" style="margin-left: 60px"></div>
        </form>
    </div>
    <div class="col-lg-6">
        <h3>Secure APIs and Pages</h3>
        
        <ul>
            <li><a href="/Home/RequiresAuth">/Home/RequiresAuth</a> - Requires Authentication MVC Page</li>
            <li><a href="/Home/RequiresRole">/Home/RequiresRole</a> - Requires <b>Manager</b> Role MVC Page</li>
        </ul>
        
        <form action="/requiresauth">
            <h4>/requiresauth ServiceStack API</h4>
            <label>Name: </label>
            <input type="text" class="txtName" name="Name" style="margin: 10px" />
            <span class="apiurl"></span>
            <div class="result" style="margin-left: 60px"></div>            
        </form>
        
        <form action="/requiresrole">
            <h4>/requiresrole ServiceStack API</h4>
            <label>Name: </label>
            <input type="text" class="txtName" name="Name" style="margin: 10px" />
            <span class="apiurl"></span>
            <div class="result" style="margin-left: 60px"></div>            
        </form>
    </div>
</div>

<script>
window.addEventListener('load', function() {
    $(".txtName").keyup(function () {
        var $result = $(this).parent().find('.result');
        var $apiurl = $(this).parent().find('.apiurl');
        if (this.value) {
            var apiUrl =  $(this).parent().attr('action') + "/" + encodeURIComponent(this.value);
            $apiurl.html('<a href="' + apiUrl + '">' + apiUrl + '</a>');
            $.getJSON(apiUrl)
                .then(function (r) {
                    $result.html(r.result);
                }).fail(function (jq, jqStatus, statusText) {
                    var err, errMsg = "The request failed with: " + statusText;
                    try {
                        err = JSON.parse(jq.responseText);
                        errMsg = err.message || errMsg;
                    } catch (e) {
                    }
                    $result.html('<div class="error">' + errMsg + "</div>");
                });
        } else {
            $result.add($apiurl).html("");
        }
    });
        
    $(document).bindHandlers({
       switchUser: function(u) {
           $("#userName").val(u);
           $("#password").val('test');
       }
    });        
});
</script>
